<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Jan Vraný - </title>
    <link rel="stylesheet" href="/pygments.css">
    <link rel="stylesheet" href="/stylesheet.css">
    

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="Nanoc 4.4.2">
  </head>
  <body>
    <div id="header">
      <div id="jv">
        Jan Vraný
      </div>

    	<ul>
    	<li><a href="/">home</a></li>
    	<li><a href="/posts">blog</a></li>
        <li><a href="/projects">projects</a></li>                      
        <li><a href="https://bitbucket.org/janvrany/">repositories</a></li>
        <li><a href="/contact">contact</a></li>        
        <li><a href="/cv.pdf">cv</a></li>
    	</ul>
    </div>
    <div id="main">
      <div class="posts column width1_2">
  
    
      
        <div class='post'>
          <h1><a href="/2017/08/csr-mini-howto.html">How to generate TSL/SSL certificate and get it signed</a></h1>
          <aside>Posted at: August 17, 2017</aside>
          <article>
            
<h1 id="introduction">Introduction</h1>

<p>I’m not much of an expert in cryptography and <a href="https://openvpn.net/">PKI</a> and these things are 
insanely complex. My use-case is quite simple: I run several [OpenVPN][2] servers
so I can access services behind that server from anywhere - safely.</p>

<p>OpenVPN uses TSL/SSL certificates to authenticate clients, this means that
server accepts connection from any client that presents a valid certificate.
“Valid” means certificate that is signed by a <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA</a> the server is configured
to trust. So each client needs it’s private key (<code>.key</code>) and certificate (<code>.crt</code>).</p>

<p>Now the question is: how does one get these? Suppose the guy I’d like to give an
access my VPN server is far away. Indeed I can generate all this, sign it and send
him these files over email, Jabber, Slack channel - you name it. But is this 
safe enough? I’d say all these channels are insecure so some bad guy can intercept
the message, stole key and certificate and use it for unauthorized access to 
the VPN server under a name of my friend.</p>

<p>So the question is: how does one get these safely? The answer is: the one has
to generate her own key herself and then send the certificate to the CA for signing. 
This is safe enough - private key need not to leave ones computer and certificate
is by definition public so can be safely sent to anyone.</p>

<p>Here’s</p>

<h2 id="how-to-create-a-private-key-and-certificate-signing-request">How to create a private key and certificate signing request</h2>

<p><em>Step 1: Create SSL configuration file</em></p>

<p>As we’re using <code>openssl</code>, you’d need a configuration file for it. Following 
would do (save it to some file, say <code>ssl.conf</code>):</p>

<pre><code>[ req ]
default_bits	= 2048
distinguished_name	= req_distinguished_name
prompt		= yes
default_md		= sha256

[ req_distinguished_name ]

[ client ]
basicConstraints	= critical, CA:FALSE
subjectKeyIdentifier	= hash
authorityKeyIdentifier	= keyid:always,issuer:always
keyUsage		= digitalSignature, keyEncipherment
nsCertType		= client
extendedKeyUsage	= critical, clientAuth
</code></pre>

<p><em>Step 2: Generate a new key</em></p>

<pre><code>openssl genrsa -out client.key -des3 2048
</code></pre>

<p>This will generate a new 2048 bit RSA (private) key and save it to <code>client.key</code>. This is the
secret file no-one else should have access too. The <code>-des3</code> encrypts the key using
a passphrase - you’ll be asked for it. Depending on your paranoia you may increase
key bitsize to say 4096.</p>

<p><em>Step 3: Generate certificate signing request</em></p>

<p>Certificate signing request (<code>.csr</code>) is a file that it later processed by the CA
to actually issue a signed certificate. Essentially, <code>.csr</code> contains a public key
plus some other metadata such as who’s certificate it’s going be. This is a lengthy 
command:</p>

<pre><code>openssl req -config 'ssl.conf' -new -key 'client.key' -out 'client.csr' -extensions client \
    -subj '/C=UK/ST=United Kingdom/L=Dundee/O=Some Company/emailAddress=some.guy@somecompany.co.uk/CN=Guy Some/'
</code></pre>

<p>Replace values in <code>-subj</code> accordingly - this identifies who’s certificate it is. 
This produdes a file <code>client.csr</code> which we will need shortly.</p>

<p><em>Step 4: Send <code>.csr</code> to the CA to get it signed</em></p>

<p>Now take the <code>client.csr</code> you’ve created earlier and send it to the CA (in the
case of OpenVPN run by me, send it to me). The CA will (eventyally) sign it and
send you back the signed certificate (<code>.crt</code>) which then can be used to 
authenticate to VPN server (or for other purposes). As there’s nothing secret
in the <code>.csr</code> not <code>.crt</code> one may use email, Jabber, Slack channel, you name it, 
to send it back and forth.</p>

<h1 id="final-word">Final word</h1>

<p>Hope that helps, have fun.</p>


          </article>
        </div>
        
    
      
        <div class='post'>
          <h1><a href="/2017/06/stx-libjava-used-for-real.html">STX:LIBJAVA used for real</a></h1>
          <aside>Posted at: June 7, 2017</aside>
          <article>
            
<p>No long ago I learned that <a href="https://swing.fit.cvut.cz/projects/stx-jv">Smalltalk/X jv-branch</a> and <a href="https://swing.fit.cvut.cz/projects/stx-libjava">STX:LIBJAVA</a> are 
used for real, in “industry”.</p>

<div class='read-more'><a href='/2017/06/stx-libjava-used-for-real.html'>Continue reading &rsaquo;</a></div>
          </article>
        </div>
        
    
      
        <div class='post'>
          <h1><a href="/2017/06/unamaged-delegates.html">Unmanaged delegates in CLR</a></h1>
          <aside>Posted at: June 7, 2017</aside>
          <article>
            
<p>As we progressed with <a href="/2016/10/a-taste-of-dotNET-in-Bee-Smalltalk.html">CLR interop for Bee Smalltalk</a>, a need to create 
a delegate for an unmanaged code arose. By “a delegate for an unmanaged code” I mean
an instance of a <a href="https://docs.microsoft.com/en-us/dotnet/articles/csharp/programming-guide/delegates/">delegate</a> object that can be passed to CLR code which, when
called, would execute an unmanaged code. In our case a Smalltalk code.</p>

<p>This can be handy, maybe necessary, if we want write a code that handles
events. And we may well would like to do so, writing some UI code using .NET
classes without use of event handlers seems to be impossible. Moreover, there
are other interesting events we may want to handle, such as 
<a href="https://msdn.microsoft.com/en-us/library/system.appdomain.firstchanceexception%28v=vs.110%29.aspx">AppDomain.FirstChanceException</a>.</p>

<p>Looking at the .NET documentation. this seem to be an easy task. Just use 
<a href="https://msdn.microsoft.com/en-us/library/zdx6dyyh%28v=vs.110%29.aspx">Marshal.GetDelegateForFunctionPointer()</a> to create a delegate object for
an arbitrary function pointer. Looks easy but it turned out to be a little more
tricky. And not very well documented. The following text describes my findings
and my solution so far. Mainly for my (our) own record but someone else may find 
useful too.</p>

<div class='read-more'><a href='/2017/06/unamaged-delegates.html'>Continue reading &rsaquo;</a></div>
          </article>
        </div>
        
    
      
        <div class='post'>
          <h1><a href="/2017/01/debugging-mixed-native-clr-application-in-windbg.html">Debugging mixed native-CLR application in WinDBG</a></h1>
          <aside>Posted at: January 25, 2017</aside>
          <article>
            
<p>While working on <a href="/2016/10/a-taste-of-dotNET-in-Bee-Smalltalk.html">CLR interop for Bee Smalltalk</a>, things go wrong every now and
again. This is tricky to debug, at least for me, as there is Smalltalk code,
then some native C++ code (CLR’s CCW and all this stuff) and finally managed
CLR code.</p>

<p>Obviously, Smalltalk debugger is kind of useless here as one would not see
native nor managed stack there. Managed debugger is can be useful to see what’s
happening in managed code, but quite often it got confused because we’re calling
CLR from native application so more often than not all it tells you is that
something went wrong - in case you don’t know that yet.</p>

<div class='read-more'><a href='/2017/01/debugging-mixed-native-clr-application-in-windbg.html'>Continue reading &rsaquo;</a></div>
          </article>
        </div>
        
    
      
        <div class='post'>
          <h1><a href="/2016/10/a-taste-of-dotNET-in-Bee-Smalltalk.html">A taste of .NET in Bee Smalltalk</a></h1>
          <aside>Posted at: October 13, 2016</aside>
          <article>
            
<p>Couple days ago, I finally managed to get .NET to do a job for me. Not much but 
still .NET did its job and did it well. The following text shows how to call
.NET code from Bee Smalltalk and retrieve results. I won’t go into technical 
details on how it’s done internally, rather show the usage from user point of
view. The goal is to give you an idea how it might feel to call .NET code from
Bee Smalltalk.</p>

<div class='read-more'><a href='/2016/10/a-taste-of-dotNET-in-Bee-Smalltalk.html'>Continue reading &rsaquo;</a></div>
          </article>
        </div>
        
    
      
        <div class='post'>
          <h1><a href="/2016/10/fun-with-zfs-part-1-installing-debian-jessie-on-zfs-root.html">Fun with ZFS, part 1: Installing Debian Jessie on ZFS Root</a></h1>
          <aside>Posted at: October 6, 2016</aside>
          <article>
            
<h2 id="preface">Preface</h2>

<p>Couple weeks ago I decided to make myself a small home server. Home sever, 
sounds weird, doesn’t it? Home’s not work place, no?</p>

<p>Well, it is, in my case. I have no need for media center, downloading and 
streaming movies or even playing on TV, nothing like this. But I need a  storage
 for backups and host to run virtual machines on.</p>

<div class='read-more'><a href='/2016/10/fun-with-zfs-part-1-installing-debian-jessie-on-zfs-root.html'>Continue reading &rsaquo;</a></div>
          </article>
        </div>
        
    
      
        <div class='post'>
          <h1><a href="/2016/10/first-post.html">First Post</a></h1>
          <aside>Posted at: October 6, 2016</aside>
          <article>
            
<p>I’m interested in many things. I have many ideas, all of them seem cool 
initially but as soon as I try to explain them, most of them turn out to be
rubbish.</p>

<div class='read-more'><a href='/2016/10/first-post.html'>Continue reading &rsaquo;</a></div>
          </article>
        </div>
        
    
  
</div>
<div class="column width1_2">
  <div class="center">
    <img src="images/face.png"/>
  </div>
  <div>
    <p>
      There is no programming language that rules them all.
    </p>
    <p>
      I'm interested in programming languages, compilers and virtual machines, 
      in particular in multi-language programming environments.
    </p>
    <p>
      I love Smalltalk. But I'm critical about it, all the same. 
    </p>
  </div>
</div>
    </div>
    <script>
  	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  	ga('create', 'UA-80636532-1', 'auto');
  	ga('send', 'pageview');
    </script>
  </body>
</html>
